<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Write a Post</title>
    <link rel="stylesheet" href="style.css" />
</head>

<body>
    <header class="navbar">
        <div class="brand">Blogger</div>
        <nav class="nav-links">
            <a href="index.html">Home</a>
            <a href="write.html">Write Blog</a>
            <button id="darkToggle">🌙</button>
        </nav>
    </header>
    <main class="blog-post-wrapper">
        <h1 class="page-title">Write a New Blog Post</h1>

        <form id="blogForm">
            <input type="text" id="title" placeholder="Post Title" required />
            <textarea id="content" placeholder="Write your post..." required></textarea>

            <input type="text" id="tags" placeholder="Enter tags (comma-separated)" />
            <button type="submit">Add Post</button>
        </form>
    </main>
    <script>
        const blogForm = document.getElementById("blogForm");
        const titleInput = document.getElementById("title");
        const contentInput = document.getElementById("content");
        const tagsInput = document.getElementById("tags");
        const editPostData = JSON.parse(localStorage.getItem("editPost"));

        if (editPostData) {
            const post = editPostData.post;
            titleInput.value = post.title;
            contentInput.value = post.content;
            tagsInput.value = post.tags;
        }

        blogForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            const title = titleInput.value.trim();
            const content = contentInput.value.trim();
            const tags = tagsInput.value.trim();
            if (!title || !content) return;

            try {
                let res;
                if (editPostData && editPostData.post && editPostData.post.id) {
                    const id = editPostData.post.id;
                    console.log(title, content, tags);
                    res = await fetch(`http://localhost:8081/Server/BlogServlet?id=${id}`, {
                        method: "PUT",
                        headers: { "Content-Type": "application/x-www-form-urlencoded" },
                        body: new URLSearchParams({
                            title,
                            content,
                            date: new Date().toISOString(),
                            tags
                        })
                    });
                    localStorage.removeItem("editPost");
                } else {
                    res = await fetch("http://localhost:8081/Server/BlogServlet", {
                        method: "POST",
                        headers: { "Content-Type": "application/x-www-form-urlencoded" },
                        body: new URLSearchParams({
                            title,
                            content,
                            date: new Date().toISOString(),
                            tags
                        })
                    });
                }
                const text = await res.text();
                console.log("Server response:", text);
                alert("Post saved successfully!");
                blogForm.reset();
                window.location.href = "index.html";
            } catch (err) {
                console.error("Error saving post:", err);
                alert("Failed to save post");
            }
        });


        const toggle = document.getElementById("darkToggle");
        if (localStorage.getItem("darkMode") === "true") {
            document.body.classList.add("dark");
        }
        toggle.addEventListener("click", () => {
            document.body.classList.toggle("dark");
            const isDark = document.body.classList.contains("dark");
            localStorage.setItem("darkMode", isDark);
            toggle.textContent = isDark ? "☀️" : "🌙";
        });
        toggle.textContent = document.body.classList.contains("dark") ? "☀️" : "🌙";
    </script>

</body>

</html>